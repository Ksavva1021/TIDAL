input_folder: /vols/cms/lcr119/offline/HiggsCP/HiggsDNA/output/full_syst_noMETrecoil
output_path: /vols/cms/dw515/Run3_CP_workareas/TIDAL_fordatacards/TIDAL/Draw/cp_datacards_Aug22/
channels: [tt]
eras: [ Run3_2022, Run3_2022EE, Run3_2023, Run3_2023BPix]
parameter_path: /vols/cms/lcr119/offline/HiggsCP/HiggsDNA/scripts/ditau/config/
schemes: [cpdecay]
run_systematics: true

cpdecay:

  systematics:
    per_era:
      default:
        common:
         - [ "systematic_DY_Shape", "dy_pt_reweighting" ]
         - [ "systematic_TTbar_Shape", "top_pt_reweighting" ]
         - [ "systematic_Fake_Factors", "ff_*channel"]
         - [ "systematic_Tau_EnergyScale_PNet_TSCALE", "CMS_scale_t_DeepTau2018v2p5_*group_*year_genTau" ]
        # - [ "systematic_Tau_ID_PNet", "CMS_SENSIBLENAME_*year" ]
         - [ "systematic_Jet_EnergyScale_Total", "CMS_scale_j_13p6TeV" ]
         - [ "systematic_Jet_EnergyResolution", "CMS_res_j_13p6TeV" ]

  variable_definitions:
      MVA_score: "BDT_pred_score[0.3,0.4,0.5,0.6,0.7,0.8,0.9,1.0]"  
      MVA_vs_aco_rho_rho: "BDT_pred_score,aco_rho_rho[0.,0.7,0.8,0.9,1.0],(10,0,2pi)"  
      MVA_vs_aco_pi_pi: "BDT_pred_score,aco_pi_pi[0.,0.7,0.8,1.0],(4,0,2pi)"
      MVA_vs_aco_a1_a1: "BDT_pred_score,aco_a1_a1[0.,0.7,0.8,0.9,1.0],(4,0,2pi)"
      MVA_vs_aco_pi_rho: "BDT_pred_score,aco_pi_rho[0.,0.7,0.8,0.9,1.0],(10,0,2pi)"  
      MVA_vs_aco_rho_pi: "BDT_pred_score,aco_rho_pi[0.,0.7,0.8,0.9,1.0],(10,0,2pi)"  
      MVA_vs_aco_pi_a11pr: "BDT_pred_score,aco_pi_rho[0.,0.7,0.8,0.9,1.0],(4,0,2pi)"  
      MVA_vs_aco_a11pr_pi: "BDT_pred_score,aco_rho_pi[0.,0.7,0.8,0.9,1.0],(4,0,2pi)" 
      MVA_vs_aco_rho_a11pr: "BDT_pred_score,aco_rho_rho[0.,0.7,0.8,0.9,1.0],(10,0,2pi)"
      MVA_vs_aco_a1_a11pr_FASTMTT_MassConstraint: "BDT_pred_score,aco_a1_rho_FASTMTT_MassConstraint[0.,0.7,0.8,0.9,1.0],(4,0,2pi)"
      MVA_vs_aco_a11pr_a1_FASTMTT_MassConstraint: "BDT_pred_score,aco_rho_a1_FASTMTT_MassConstraint[0.,0.7,0.8,0.9,1.0],(4,0,2pi)"
      MVA_vs_aco_a1_rho_FASTMTT_MassConstraint: "BDT_pred_score,aco_a1_rho_FASTMTT_MassConstraint[0.,0.7,0.8,0.9,1.0],(10,0,2pi)"
      MVA_vs_aco_rho_a1_FASTMTT_MassConstraint: "BDT_pred_score,aco_rho_a1_FASTMTT_MassConstraint[0.,0.7,0.8,0.9,1.0],(10,0,2pi)"
      MVA_vs_aco_a1_pi_FASTMTT_MassConstraint: "BDT_pred_score,aco_a1_pi_FASTMTT_MassConstraint[0.,0.7,0.8,0.9,1.0],(4,0,2pi)"
      MVA_vs_aco_pi_a1_FASTMTT_MassConstraint: "BDT_pred_score,aco_pi_a1_FASTMTT_MassConstraint[0.,0.7,0.8,0.9,1.0],(4,0,2pi)"


  tt:
    # Nominal plots
     - { method: '4', category:  ['mva_higgs'], plotting_variable: [ MVA_score], blind: true}
     - { method: '4', category:  ['mva_tau'], plotting_variable: [ MVA_score]}
     - { method: '4', category:  ['mva_fake'], plotting_variable: [ MVA_score]}
     - { method: '4', category:  ['higgs_rhorho'], plotting_variable: [ MVA_vs_aco_rho_rho], blind: true, unroll: true}
     - { method: '4', category:  ['higgs_pipi'], plotting_variable: [ MVA_vs_aco_pi_pi], blind: true, unroll: true}
     - { method: '4', category:  ['higgs_a1a1'], plotting_variable: [ MVA_vs_aco_a1_a1], blind: true, unroll: true}
     - { method: '4', category:  ['higgs_pirho'], plotting_variable: [ MVA_vs_aco_pi_rho], blind: true, unroll: true}
     - { method: '4', category:  ['higgs_rhopi'], plotting_variable: [ MVA_vs_aco_rho_pi], blind: true, unroll: true}
     - { method: '4', category:  ['higgs_pia11pr'], plotting_variable: [ MVA_vs_aco_pi_a11pr], blind: true, unroll: true}
     - { method: '4', category:  ['higgs_a11prpi'], plotting_variable: [ MVA_vs_aco_a11pr_pi], blind: true, unroll: true}
     - { method: '4', category:  ['higgs_rhoa11pr'], plotting_variable: [ MVA_vs_aco_rho_a11pr], blind: true, unroll: true}
     - { method: '4', category:  ['higgs_a1a11pr'], plotting_variable: [ MVA_vs_aco_a1_a11pr_FASTMTT_MassConstraint], blind: true, unroll: true}
     - { method: '4', category:  ['higgs_a11pra1'], plotting_variable: [ MVA_vs_aco_a11pr_a1_FASTMTT_MassConstraint], blind: true, unroll: true}
     - { method: '4', category:  ['higgs_a1rho'], plotting_variable: [ MVA_vs_aco_a1_rho_FASTMTT_MassConstraint], blind: true, unroll: true}
     - { method: '4', category:  ['higgs_rhoa1'], plotting_variable: [ MVA_vs_aco_rho_a1_FASTMTT_MassConstraint], blind: true, unroll: true}
     - { method: '4', category:  ['higgs_a1pi'], plotting_variable: [ MVA_vs_aco_a1_pi_FASTMTT_MassConstraint], blind: true, unroll: true}
     - { method: '4', category:  ['higgs_pia1'], plotting_variable: [ MVA_vs_aco_pi_a1_FASTMTT_MassConstraint], blind: true, unroll: true}
    # aiso (for fake factor systematics)
     - { method: '4', category:  ['mva_tau'], plotting_variable: [ MVA_score], aiso: true}
     - { method: '4', category:  ['mva_fake'], plotting_variable: [ MVA_score], aiso: true}
     - { method: '4', category:  ['higgs_rhorho'], plotting_variable: [ MVA_vs_aco_rho_rho], aiso: true, unroll: true}
     - { method: '4', category:  ['higgs_pipi'], plotting_variable: [ MVA_vs_aco_pi_pi], aiso: true, unroll: true}
     - { method: '4', category:  ['higgs_a1a1'], plotting_variable: [ MVA_vs_aco_a1_a1], aiso: true, unroll: true}
     - { method: '4', category:  ['higgs_pirho'], plotting_variable: [ MVA_vs_aco_pi_rho], aiso: true, unroll: true}
     - { method: '4', category:  ['higgs_rhopi'], plotting_variable: [ MVA_vs_aco_rho_pi], aiso: true, unroll: true}
     - { method: '4', category:  ['higgs_pia11pr'], plotting_variable: [ MVA_vs_aco_pi_a11pr], aiso: true, unroll: true}
     - { method: '4', category:  ['higgs_a11prpi'], plotting_variable: [ MVA_vs_aco_a11pr_pi], aiso: true, unroll: true}
     - { method: '4', category:  ['higgs_rhoa11pr'], plotting_variable: [ MVA_vs_aco_rho_a11pr], aiso: true, unroll: true}
     - { method: '4', category:  ['higgs_a1a11pr'], plotting_variable: [ MVA_vs_aco_a1_a11pr_FASTMTT_MassConstraint], aiso: true, unroll: true}
     - { method: '4', category:  ['higgs_a11pra1'], plotting_variable: [ MVA_vs_aco_a11pr_a1_FASTMTT_MassConstraint], aiso: true, unroll: true}
     - { method: '4', category:  ['higgs_a1rho'], plotting_variable: [ MVA_vs_aco_a1_rho_FASTMTT_MassConstraint], aiso: true, unroll: true}
     - { method: '4', category:  ['higgs_rhoa1'], plotting_variable: [ MVA_vs_aco_rho_a1_FASTMTT_MassConstraint], aiso: true, unroll: true}
     - { method: '4', category:  ['higgs_a1pi'], plotting_variable: [ MVA_vs_aco_a1_pi_FASTMTT_MassConstraint], aiso: true, unroll: true}
     - { method: '4', category:  ['higgs_pia1'], plotting_variable: [ MVA_vs_aco_pi_a1_FASTMTT_MassConstraint], aiso: true, unroll: true}


control:   # GENERAL CONTROL PLOTS (kinematics etc)
  variable_definitions:
    m_vis: "m_vis(50,0,400)"
    pt_1: "pt_1(40,0,200)"
    pt_2: "pt_2(40,0,200)"
    eta_1: "eta_1(21,-2.1,2.1)"
    eta_2: "eta_2(21,-2.1,2.1)"
    phi_1: "phi_1(32,-pi,pi)"
    phi_2: "phi_2(32,-pi,pi)"
    dR: "dR(42,0,5)"
    pt_tt: "pt_tt(50,0,400)"
    met_pt: "met_pt(40,0,200)"
    met_phi: "met_phi(32,-pi,pi)"
    n_jets: "n_jets(10,0,10)"

  tt:
  # option to use filtered DY (false by default): `use_filtered_DY: true`
  - { method: "4", category:  [ cp_inclusive ], plotting_variable: [ m_vis]}


cpdecay_fakefactors_control:

  variable_definitions:
      aco_rho_rho: "aco_rho_rho(10,0,2pi)"
      aco_pi_pi: "aco_pi_pi(4,0,2pi)"
      aco_a1_a1: "aco_a1_a1(4,0,2pi)"
      aco_pi_rho: "aco_pi_rho(10,0,2pi)"
      aco_rho_pi: "aco_rho_pi(10,0,2pi)"
      aco_pi_a11pr: "aco_pi_rho(4,0,2pi)"
      aco_a11pr_pi: "aco_rho_pi(4,0,2pi)"
      aco_rho_a11pr: "aco_rho_rho(10,0,2pi)"
      aco_a1_a11pr_FASTMTT_MassConstraint: "aco_a1_rho_FASTMTT_MassConstraint(4,0,2pi)"
      aco_a11pr_a1_FASTMTT_MassConstraint: "aco_rho_a1_FASTMTT_MassConstraint(4,0,2pi)"
      aco_a1_rho_FASTMTT_MassConstraint: "aco_a1_rho_FASTMTT_MassConstraint(10,0,2pi)"
      aco_rho_a1_FASTMTT_MassConstraint: "aco_rho_a1_FASTMTT_MassConstraint(10,0,2pi)"
      aco_a1_pi_FASTMTT_MassConstraint: "aco_a1_pi_FASTMTT_MassConstraint(4,0,2pi)"
      aco_pi_a1_FASTMTT_MassConstraint: "aco_pi_a1_FASTMTT_MassConstraint(4,0,2pi)"

      BDT_pred_score: "BDT_pred_score[0.,0.7,0.8,0.9,1.0]" # move to other scheme later
      BDT_pred_score_wide: "BDT_pred_score[0.,0.7,0.8,1.0]"

  tt:
    # These can be used to evaluate agreement of fake factors
     - { method: '4', category:  ['mva_higgs'], plotting_variable: [ BDT_pred_score],  aiso: true}
     - { method: '4', category:  ['higgs_rhorho'], plotting_variable: [ aco_rho_rho], aiso: true, nodename: "_aco"}
     - { method: '4', category:  ['higgs_pipi'], plotting_variable: [ aco_pi_pi], aiso: true, nodename: "_aco"}
     - { method: '4', category:  ['higgs_a1a1'], plotting_variable: [ aco_a1_a1], aiso: true, nodename: "_aco"}
     - { method: '4', category:  ['higgs_pirho'], plotting_variable: [ aco_pi_rho], aiso: true, nodename: "_aco"}
     - { method: '4', category:  ['higgs_rhopi'], plotting_variable: [ aco_rho_pi], aiso: true, nodename: "_aco"}
     - { method: '4', category:  ['higgs_pia11pr'], plotting_variable: [ aco_pi_a11pr], aiso: true, nodename: "_aco"}
     - { method: '4', category:  ['higgs_a11prpi'], plotting_variable: [ aco_a11pr_pi], aiso: true, nodename: "_aco"}
     - { method: '4', category:  ['higgs_rhoa11pr'], plotting_variable: [ aco_rho_a11pr], aiso: true, nodename: "_aco"}
     - { method: '4', category:  ['higgs_a1a11pr'], plotting_variable: [ aco_a1_a11pr_FASTMTT_MassConstraint], aiso: true, nodename: "_aco"}
     - { method: '4', category:  ['higgs_a11pra1'], plotting_variable: [ aco_a11pr_a1_FASTMTT_MassConstraint], aiso: true, nodename: "_aco"}
     - { method: '4', category:  ['higgs_a1rho'], plotting_variable: [ aco_a1_rho_FASTMTT_MassConstraint], aiso: true, nodename: "_aco"}
     - { method: '4', category:  ['higgs_rhoa1'], plotting_variable: [ aco_rho_a1_FASTMTT_MassConstraint], aiso: true, nodename: "_aco"}
     - { method: '4', category:  ['higgs_a1pi'], plotting_variable: [ aco_a1_pi_FASTMTT_MassConstraint], aiso: true, nodename: "_aco"}
     - { method: '4', category:  ['higgs_pia1'], plotting_variable: [ aco_pi_a1_FASTMTT_MassConstraint], aiso: true, nodename: "_aco"}
     # These can be used to evaluate BDT score
     - { method: '4', category:  ['higgs_rhorho'], plotting_variable: [ BDT_pred_score], aiso: true, nodename: "_BDT_score"}
     - { method: '4', category:  ['higgs_pipi'], plotting_variable: [ BDT_pred_score_wide], aiso: true, nodename: "_BDT_score"}
     - { method: '4', category:  ['higgs_a1a1'], plotting_variable: [ BDT_pred_score], aiso: true, nodename: "_BDT_score"}
     - { method: '4', category:  ['higgs_pirho'], plotting_variable: [ BDT_pred_score], aiso: true, nodename: "_BDT_score"}
     - { method: '4', category:  ['higgs_rhopi'], plotting_variable: [ BDT_pred_score], aiso: true, nodename: "_BDT_score"}
     - { method: '4', category:  ['higgs_pia11pr'], plotting_variable: [ BDT_pred_score], aiso: true, nodename: "_BDT_score"}
     - { method: '4', category:  ['higgs_a11prpi'], plotting_variable: [ BDT_pred_score], aiso: true, nodename: "_BDT_score"}
     - { method: '4', category:  ['higgs_rhoa11pr'], plotting_variable: [ BDT_pred_score], aiso: true, nodename: "_BDT_score"}
     - { method: '4', category:  ['higgs_a1a11pr'], plotting_variable: [ BDT_pred_score], aiso: true, nodename: "_BDT_score"}
     - { method: '4', category:  ['higgs_a11pra1'], plotting_variable: [ BDT_pred_score], aiso: true, nodename: "_BDT_score"}
     - { method: '4', category:  ['higgs_a1pi'], plotting_variable: [ BDT_pred_score], aiso: true, nodename: "_BDT_score"}
     - { method: '4', category:  ['higgs_pia1'], plotting_variable: [ BDT_pred_score], aiso: true, nodename: "_BDT_score"}
    # look at SS control plot for pipi, since the aco angle agreement looks bad in the aiso region
     - { method: '4', category:  ['higgs_pipi'], plotting_variable: [ aco_pi_pi], same_sign: true}




